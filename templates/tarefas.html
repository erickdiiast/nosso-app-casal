{% extends "base.html" %}

{% block title %}Tarefas - {{ usuario.nome }}{% endblock %}
{% block header_title %}ğŸ“ Tarefas{% endblock %}

{% block content %}
<a href="{{ url_for('dashboard') }}" class="back-link">â† Voltar</a>

<!-- Criar nova tarefa -->
<div class="card">
    <div class="card-title">Criar Tarefa para {{ parceiro.nome }}</div>
    <form action="{{ url_for('criar_tarefa') }}" method="POST">
        <div class="form-group">
            <input type="text" name="titulo" placeholder="Nome da tarefa (ex: Lavar a louÃ§a)" required>
        </div>
        <div class="form-group">
            <textarea name="descricao" rows="2" placeholder="DescriÃ§Ã£o opcional..."></textarea>
        </div>
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 600; color: #333;">
                <input type="checkbox" name="recorrente" value="1" style="width: 20px; height: 20px;">
                <span>ğŸ” Tarefa recorrente (cria nova automaticamente ao concluir)</span>
            </label>
        </div>
        <div class="form-group" id="frequencia-group" style="display: none;">
            <select name="frequencia" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 12px; width: 100%;">
                <option value="diaria">ğŸ“… DiÃ¡ria (todo dia)</option>
                <option value="semanal">ğŸ“… Semanal (toda semana)</option>
                <option value="quinzenal">ğŸ“… Quinzenal (a cada 15 dias)</option>
                <option value="mensal">ğŸ“… Mensal (todo mÃªs)</option>
            </select>
        </div>
        <div class="form-group">
            <input type="number" name="pontos" placeholder="Pontos" value="10" min="1" required>
        </div>
        <button type="submit" class="btn btn-primary">Criar Tarefa</button>
    </form>
    
    <script>
        document.querySelector('input[name="recorrente"]').addEventListener('change', function() {
            document.getElementById('frequencia-group').style.display = this.checked ? 'block' : 'none';
        });
    </script>
</div>

<!-- Minhas tarefas pendentes -->
<div class="card">
    <div class="card-title">â³ Minhas Tarefas Pendentes ({{ minhas_tarefas|length }})</div>
    
    {% if minhas_tarefas %}
        {% for tarefa in minhas_tarefas %}
        <div class="item" {% if tarefa.recorrente %}style="border-left: 4px solid #FF9800;"{% endif %}>
            <div class="item-header">
                <span class="item-title">
                    {% if tarefa.recorrente %}ğŸ” {% endif %}{{ tarefa.titulo }}
                    {% if tarefa.recorrente %}
                        <span style="font-size: 0.75rem; background: #FF9800; color: white; padding: 2px 8px; border-radius: 10px;">
                            {{ {'diaria': 'DiÃ¡ria', 'semanal': 'Semanal', 'quinzenal': 'Quinzenal', 'mensal': 'Mensal'}.get(tarefa.frequencia, 'Recorrente') }}
                        </span>
                    {% endif %}
                </span>
                <span class="item-points">+{{ tarefa.pontos }} pts</span>
            </div>
            {% if tarefa.descricao %}
            <div class="item-desc">{{ tarefa.descricao }}</div>
            {% endif %}
            <div class="item-meta">
                <span>Criada por: {{ tarefa.criado_por.nome }}</span>
            </div>
            <form action="{{ url_for('concluir_tarefa', id=tarefa.id) }}" method="POST" enctype="multipart/form-data" style="margin-top: 10px;">
                <div class="file-input-wrapper" style="margin-bottom: 10px;">
                    <input type="file" name="foto_comprovacao" id="foto-{{ tarefa.id }}" accept="image/*">
                    <label for="foto-{{ tarefa.id }}" class="file-input-label" style="padding: 10px;">
                        ğŸ“· Tirar foto de comprovaÃ§Ã£o
                    </label>
                </div>
                <button type="submit" class="btn btn-success">âœ“ Marcar como ConcluÃ­da</button>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ‰</div>
            <p>VocÃª nÃ£o tem tarefas pendentes!<br>Aproveite para descansar!</p>
        </div>
    {% endif %}
</div>

<!-- Tarefas que criei para o parceiro -->
<div class="card">
    <div class="card-title">ğŸ“‹ Tarefas de {{ parceiro.nome }} ({{ tarefas_criadas|length }})</div>
    
    {% if tarefas_criadas %}
        {% for tarefa in tarefas_criadas %}
        <div class="item" {% if tarefa.recorrente %}style="border-left: 4px solid #FF9800;"{% endif %}>
            <div class="item-header">
                <span class="item-title">
                    {% if tarefa.recorrente %}ğŸ” {% endif %}{{ tarefa.titulo }}
                    {% if tarefa.recorrente %}
                        <span style="font-size: 0.75rem; background: #FF9800; color: white; padding: 2px 8px; border-radius: 10px;">
                            {{ {'diaria': 'DiÃ¡ria', 'semanal': 'Semanal', 'quinzenal': 'Quinzenal', 'mensal': 'Mensal'}.get(tarefa.frequencia, 'Recorrente') }}
                        </span>
                    {% endif %}
                </span>
                <span class="item-points">+{{ tarefa.pontos }} pts</span>
            </div>
            {% if tarefa.descricao %}
            <div class="item-desc">{{ tarefa.descricao }}</div>
            {% endif %}
            <div class="item-meta" style="justify-content: space-between;">
                <span>Aguardando {{ parceiro.nome }}</span>
                <a href="{{ url_for('excluir_tarefa', id=tarefa.id) }}" class="btn btn-danger btn-small" onclick="return confirm('Remover tarefa?')">Remover</a>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ¤”</div>
            <p>VocÃª nÃ£o criou tarefas para {{ parceiro.nome }}.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
